<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محلل الدوال الرياضية المتكامل</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- MathJax for math rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Chart.js for graphing -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Math.js for advanced math calculations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.9.0/math.js"></script>
    <!-- Algebra.js for symbolic computation -->
    <script src="https://cdn.jsdelivr.net/npm/algebra.js@0.2.6/algebra.min.js"></script>
    <!-- Nerdamer for symbolic math -->
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/nerdamer.core.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/Calculus.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/Algebra.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.12/Extra.js"></script>
    
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.7;
        }
        
        .container {
            width: 95%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), #1a2530);
            color: white;
            padding: 20px 0;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            margin-bottom: 25px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            background: var(--secondary);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        
        .logo-text h1 {
            font-size: 1.8rem;
            font-weight: 800;
        }
        
        .logo-text p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
        
        .nav-menu ul {
            display: flex;
            list-style: none;
            gap: 10px;
        }
        
        .nav-menu a {
            color: white;
            text-decoration: none;
            padding: 10px 18px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-menu a:hover, .nav-menu a.active {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1.2fr 0.8fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            border: 1px solid #eee;
        }
        
        .card-title {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .card-title i {
            color: var(--secondary);
        }
        
        .input-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: var(--dark);
            font-size: 1.05rem;
        }
        
        .function-input-container {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .function-input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1rem;
            direction: ltr;
            text-align: left;
        }
        
        .function-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .btn-primary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
        }
        
        .btn-secondary {
            background: var(--gray);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-danger {
            background: var(--accent);
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 25px;
        }
        
        .function-examples {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .example-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 0.9rem;
            font-family: 'Courier New', monospace;
        }
        
        .example-btn:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
            transform: translateY(-2px);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-top: 20px;
        }
        
        .analysis-step {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border-right: 5px solid var(--secondary);
            transition: all 0.3s;
        }
        
        .analysis-step:hover {
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: var(--secondary);
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .step-title {
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 700;
            flex: 1;
            margin-right: 15px;
        }
        
        .math-display {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 1px solid #eee;
            font-size: 1.1rem;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .results-table th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 700;
        }
        
        .results-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }
        
        .results-table tr:last-child td {
            border-bottom: none;
        }
        
        .positive {
            color: var(--success);
            font-weight: bold;
        }
        
        .negative {
            color: var(--accent);
            font-weight: bold;
        }
        
        .zero {
            color: var(--warning);
            font-weight: bold;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--secondary);
            animation: spin 1s linear infinite;
            margin-right: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .settings-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .setting-item {
            display: flex;
            flex-direction: column;
        }
        
        .setting-item label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }
        
        .setting-item input, .setting-item select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .function-types {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .type-tag {
            background: #e8f4fc;
            color: var(--secondary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            border: 2px solid #d1e7f5;
        }
        
        .footer {
            background: var(--dark);
            color: white;
            padding: 30px 0;
            margin-top: 50px;
            border-radius: 20px 20px 0 0;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .social-links {
            display: flex;
            gap: 15px;
        }
        
        .social-links a {
            color: white;
            font-size: 1.3rem;
            transition: color 0.3s;
        }
        
        .social-links a:hover {
            color: var(--warning);
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 20px;
            color: rgba(255, 255, 255, 0.7);
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .function-input-container {
                flex-direction: column;
            }
            
            .btn-group {
                justify-content: center;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
        }
        
        .error-message {
            background: #fee;
            color: var(--accent);
            padding: 15px;
            border-radius: 8px;
            border-right: 5px solid var(--accent);
            margin: 15px 0;
            display: none;
        }
        
        .success-message {
            background: #e8f8ef;
            color: var(--success);
            padding: 15px;
            border-radius: 8px;
            border-right: 5px solid var(--success);
            margin: 15px 0;
            display: none;
        }
        
        .advanced-options {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px dashed #eee;
        }
        
        .toggle-advanced {
            background: none;
            border: none;
            color: var(--secondary);
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            padding: 10px 0;
        }
        
        .advanced-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .advanced-content.expanded {
            max-height: 1000px;
        }
        
        .symbol-palette {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .symbol-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            font-family: 'Cambria Math', serif;
            transition: all 0.2s;
        }
        
        .symbol-btn:hover {
            background: var(--light);
            border-color: var(--secondary);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <div class="logo-text">
                        <h1>محلل الدوال الرياضية المتكامل</h1>
                        <p>تحليل شامل لأي دالة رياضية - خطوة بخطوة</p>
                    </div>
                </div>
                <nav class="nav-menu">
                    <ul>
                        <li><a href="#" class="active"><i class="fas fa-home"></i> الرئيسية</a></li>
                        <li><a href="#"><i class="fas fa-book"></i> الدروس</a></li>
                        <li><a href="#"><i class="fas fa-download"></i> التحميلات</a></li>
                        <li><a href="#"><i class="fas fa-info-circle"></i> المساعدة</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="main-content">
            <!-- Left Column: Function Input and Analysis -->
            <div>
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-function"></i> إدخال الدالة الرياضية</h2>
                    
                    <div class="input-section">
                        <div class="input-group">
                            <label for="functionInput"><i class="fas fa-keyboard"></i> أدخل الدالة f(x):</label>
                            <div class="function-input-container">
                                <input type="text" id="functionInput" class="function-input" 
                                       placeholder="أدخل الدالة هنا، مثال: x^2 + sin(x) - exp(x/2)" 
                                       value="x^3 - 6*x^2 + 6*x + 3">
                                <button id="analyzeBtn" class="btn btn-primary">
                                    <i class="fas fa-chart-line"></i> تحليل الدالة
                                </button>
                            </div>
                            <div id="inputError" class="error-message"></div>
                            <div id="inputSuccess" class="success-message"></div>
                        </div>
                        
                        <div class="btn-group">
                            <button id="clearBtn" class="btn btn-secondary">
                                <i class="fas fa-trash-alt"></i> مسح الكل
                            </button>
                            <button id="derivativeBtn" class="btn btn-success">
                                <i class="fas fa-calculator"></i> حساب المشتقة
                            </button>
                            <button id="integralBtn" class="btn btn-success">
                                <i class="fas fa-integral"></i> حساب التكامل
                            </button>
                            <button id="solveBtn" class="btn btn-warning" style="background: var(--warning); color: white;">
                                <i class="fas fa-equals"></i> حل المعادلة
                            </button>
                        </div>
                        
                        <div class="advanced-options">
                            <button class="toggle-advanced" id="toggleAdvanced">
                                <i class="fas fa-chevron-down"></i> خيارات متقدمة ورموز رياضية
                            </button>
                            <div class="advanced-content" id="advancedContent">
                                <div class="symbol-palette">
                                    <button class="symbol-btn" onclick="insertSymbol('+')">+</button>
                                    <button class="symbol-btn" onclick="insertSymbol('-')">-</button>
                                    <button class="symbol-btn" onclick="insertSymbol('*')">×</button>
                                    <button class="symbol-btn" onclick="insertSymbol('/')">÷</button>
                                    <button class="symbol-btn" onclick="insertSymbol('^')">^</button>
                                    <button class="symbol-btn" onclick="insertSymbol('(')">(</button>
                                    <button class="symbol-btn" onclick="insertSymbol(')')">)</button>
                                    <button class="symbol-btn" onclick="insertSymbol('sqrt(')">√</button>
                                    <button class="symbol-btn" onclick="insertSymbol('sin(')">sin</button>
                                    <button class="symbol-btn" onclick="insertSymbol('cos(')">cos</button>
                                    <button class="symbol-btn" onclick="insertSymbol('tan(')">tan</button>
                                    <button class="symbol-btn" onclick="insertSymbol('log(')">log</button>
                                    <button class="symbol-btn" onclick="insertSymbol('ln(')">ln</button>
                                    <button class="symbol-btn" onclick="insertSymbol('exp(')">exp</button>
                                    <button class="symbol-btn" onclick="insertSymbol('abs(')">|x|</button>
                                    <button class="symbol-btn" onclick="insertSymbol('pi')">π</button>
                                    <button class="symbol-btn" onclick="insertSymbol('e')">e</button>
                                    <button class="symbol-btn" onclick="insertSymbol('x')">x</button>
                                    <button class="symbol-btn" onclick="insertSymbol('y')">y</button>
                                </div>
                                
                                <div class="settings-panel">
                                    <h4><i class="fas fa-sliders-h"></i> إعدادات التحليل</h4>
                                    <div class="settings-grid">
                                        <div class="setting-item">
                                            <label for="domainStart">بداية المجال:</label>
                                            <input type="number" id="domainStart" value="-5" step="0.5">
                                        </div>
                                        <div class="setting-item">
                                            <label for="domainEnd">نهاية المجال:</label>
                                            <input type="number" id="domainEnd" value="5" step="0.5">
                                        </div>
                                        <div class="setting-item">
                                            <label for="stepSize">دقة التحليل:</label>
                                            <select id="stepSize">
                                                <option value="0.1">عالية (0.1)</option>
                                                <option value="0.2" selected>متوسطة (0.2)</option>
                                                <option value="0.5">منخفضة (0.5)</option>
                                            </select>
                                        </div>
                                        <div class="setting-item">
                                            <label for="analysisType">نوع التحليل:</label>
                                            <select id="analysisType">
                                                <option value="full">تحليل كامل</option>
                                                <option value="derivative">المشتقات فقط</option>
                                                <option value="integral">التكاملات فقط</option>
                                                <option value="graph">الرسم البياني فقط</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="function-examples">
                        <div class="example-btn" onclick="loadExample('x^2 - 3*x + 2')">x² - 3x + 2</div>
                        <div class="example-btn" onclick="loadExample('sin(x) + cos(2*x)')">sin(x) + cos(2x)</div>
                        <div class="example-btn" onclick="loadExample('exp(-x^2/2)')">e^(-x²/2)</div>
                        <div class="example-btn" onclick="loadExample('log(x+1)')">ln(x+1)</div>
                        <div class="example-btn" onclick="loadExample('1/(x^2+1)')">1/(x²+1)</div>
                        <div class="example-btn" onclick="loadExample('sqrt(4-x^2)')">√(4-x²)</div>
                        <div class="example-btn" onclick="loadExample('x^3 - 6*x^2 + 6*x + 3')">x³ - 6x² + 6x + 3</div>
                        <div class="example-btn" onclick="loadExample('(x^3 - 3*x^2 + x - 4)/(x-1)')">(x³-3x²+x-4)/(x-1)</div>
                        <div class="example-btn" onclick="loadExample('tan(x)')">tan(x)</div>
                        <div class="example-btn" onclick="loadExample('abs(x-2)')">|x-2|</div>
                    </div>
                </div>
                
                <div class="card" id="analysisResults">
                    <h2 class="card-title"><i class="fas fa-list-ol"></i> تحليل الدالة خطوة بخطوة</h2>
                    <div id="resultsContainer">
                        <p style="text-align: center; color: #777; padding: 40px 20px;">
                            <i class="fas fa-calculator" style="font-size: 3rem; color: #ddd; margin-bottom: 20px; display: block;"></i>
                            أدخل دالة رياضية ثم اضغط على زر "تحليل الدالة" لعرض التحليل الكامل هنا
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Graph and Additional Info -->
            <div>
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-chart-line"></i> التمثيل البياني</h2>
                    <div class="chart-container">
                        <canvas id="functionChart"></canvas>
                    </div>
                    
                    <div class="settings-panel">
                        <h4><i class="fas fa-cog"></i> إعدادات الرسم البياني</h4>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <label for="xMin">الحد الأدنى لـ X:</label>
                                <input type="number" id="xMin" value="-5" step="0.5">
                            </div>
                            <div class="setting-item">
                                <label for="xMax">الحد الأقصى لـ X:</label>
                                <input type="number" id="xMax" value="5" step="0.5">
                            </div>
                            <div class="setting-item">
                                <label for="yMin">الحد الأدنى لـ Y:</label>
                                <input type="number" id="yMin" value="-10" step="1">
                            </div>
                            <div class="setting-item">
                                <label for="yMax">الحد الأقصى لـ Y:</label>
                                <input type="number" id="yMax" value="10" step="1">
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button id="updateChartBtn" class="btn btn-primary">
                                <i class="fas fa-sync-alt"></i> تحديث الرسم
                            </button>
                            <button id="exportChartBtn" class="btn btn-secondary">
                                <i class="fas fa-download"></i> حفظ الصورة
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-info-circle"></i> معلومات عن الدالة</h2>
                    <div id="functionInfo">
                        <p style="text-align: center; color: #777; padding: 20px;">
                            سيتم عرض معلومات الدالة هنا بعد التحليل
                        </p>
                    </div>
                    
                    <div class="function-types" id="detectedTypes">
                        <!-- Detected function types will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div>
                    <h3>محلل الدوال الرياضية المتكامل</h3>
                    <p>أداة متكاملة لتحليل الدوال الرياضية خطوة بخطوة لطلاب المرحلة الثانوية والجامعية</p>
                </div>
                <div class="social-links">
                    <a href="#"><i class="fab fa-github"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                    <a href="#"><i class="fab fa-telegram"></i></a>
                </div>
            </div>
            <div class="copyright">
                <p>© 2023 - جميع الحقوق محفوظة | تم التطوير باستخدام Math.js, Chart.js, MathJax</p>
                <p>يمكن استخدام هذا الموقع مجاناً لأغراض تعليمية غير تجارية</p>
            </div>
        </div>
    </footer>

    <script>
        // Global variables
        let functionChart;
        let currentFunction = '';
        let analysisResults = {};
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initChart();
            setupEventListeners();
            
            // Analyze the default function
            setTimeout(() => {
                analyzeFunction();
            }, 500);
        });
        
        // Initialize the chart
        function initChart() {
            const ctx = document.getElementById('functionChart').getContext('2d');
            
            functionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'f(x)',
                        data: [],
                        borderColor: 'rgba(52, 152, 219, 1)',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'x',
                                color: '#333',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'f(x)',
                                color: '#333',
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `f(${context.parsed.x.toFixed(2)}) = ${context.parsed.y.toFixed(4)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Analyze button
            document.getElementById('analyzeBtn').addEventListener('click', analyzeFunction);
            
            // Clear button
            document.getElementById('clearBtn').addEventListener('click', clearAll);
            
            // Derivative button
            document.getElementById('derivativeBtn').addEventListener('click', calculateDerivative);
            
            // Integral button
            document.getElementById('integralBtn').addEventListener('click', calculateIntegral);
            
            // Solve button
            document.getElementById('solveBtn').addEventListener('click', solveEquation);
            
            // Update chart button
            document.getElementById('updateChartBtn').addEventListener('click', updateChart);
            
            // Export chart button
            document.getElementById('exportChartBtn').addEventListener('click', exportChart);
            
            // Toggle advanced options
            document.getElementById('toggleAdvanced').addEventListener('click', toggleAdvancedOptions);
            
            // Function input - analyze on Enter key
            document.getElementById('functionInput').addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    analyzeFunction();
                }
            });
            
            // Update chart when domain inputs change
            document.getElementById('xMin').addEventListener('change', updateChart);
            document.getElementById('xMax').addEventListener('change', updateChart);
        }
        
        // Toggle advanced options
        function toggleAdvancedOptions() {
            const advancedContent = document.getElementById('advancedContent');
            const toggleIcon = document.getElementById('toggleAdvanced').querySelector('i');
            
            advancedContent.classList.toggle('expanded');
            
            if (advancedContent.classList.contains('expanded')) {
                toggleIcon.className = 'fas fa-chevron-up';
            } else {
                toggleIcon.className = 'fas fa-chevron-down';
            }
        }
        
        // Insert symbol into function input
        function insertSymbol(symbol) {
            const input = document.getElementById('functionInput');
            const start = input.selectionStart;
            const end = input.selectionEnd;
            const text = input.value;
            
            input.value = text.substring(0, start) + symbol + text.substring(end);
            input.selectionStart = input.selectionEnd = start + symbol.length;
            input.focus();
        }
        
        // Load example function
        function loadExample(example) {
            document.getElementById('functionInput').value = example;
            analyzeFunction();
        }
        
        // Clear all inputs and results
        function clearAll() {
            document.getElementById('functionInput').value = '';
            document.getElementById('resultsContainer').innerHTML = `
                <p style="text-align: center; color: #777; padding: 40px 20px;">
                    <i class="fas fa-calculator" style="font-size: 3rem; color: #ddd; margin-bottom: 20px; display: block;"></i>
                    أدخل دالة رياضية ثم اضغط على زر "تحليل الدالة" لعرض التحليل الكامل هنا
                </p>`;
            
            document.getElementById('functionInfo').innerHTML = `
                <p style="text-align: center; color: #777; padding: 20px;">
                    سيتم عرض معلومات الدالة هنا بعد التحليل
                </p>`;
            
            document.getElementById('detectedTypes').innerHTML = '';
            
            // Clear chart
            functionChart.data.datasets[0].data = [];
            functionChart.update();
            
            showSuccess('تم مسح جميع البيانات بنجاح');
        }
        
        // Main function analysis
        function analyzeFunction() {
            const funcStr = document.getElementById('functionInput').value.trim();
            
            if (!funcStr) {
                showError('الرجاء إدخال دالة رياضية أولاً');
                return;
            }
            
            // Store current function
            currentFunction = funcStr;
            
            // Show loading state
            document.getElementById('resultsContainer').innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 20px; font-size: 1.1rem;">جاري تحليل الدالة ${funcStr}...</p>
                </div>`;
            
            // Clear previous errors/success messages
            clearMessages();
            
            // Process the function asynchronously
            setTimeout(() => {
                try {
                    // Parse and validate the function
                    const parsedFunc = parseFunction(funcStr);
                    
                    if (!parsedFunc.valid) {
                        showError(`الدالة غير صالحة: ${parsedFunc.error}`);
                        return;
                    }
                    
                    // Perform full analysis
                    const analysis = performFullAnalysis(funcStr);
                    
                    // Display results
                    displayAnalysisResults(analysis);
                    
                    // Update chart
                    updateChart();
                    
                    // Update function info
                    updateFunctionInfo(analysis);
                    
                    showSuccess('تم تحليل الدالة بنجاح');
                    
                } catch (error) {
                    showError(`حدث خطأ أثناء تحليل الدالة: ${error.message}`);
                    console.error(error);
                }
            }, 800);
        }
        
        // Parse and validate function
        function parseFunction(funcStr) {
            try {
                // Try to compile the function with math.js
                const node = math.compile(funcStr);
                
                // Test evaluation
                const testValues = [-2, -1, 0, 1, 2];
                for (const x of testValues) {
                    node.evaluate({x: x});
                }
                
                return {
                    valid: true,
                    node: node
                };
            } catch (error) {
                return {
                    valid: false,
                    error: error.message
                };
            }
        }
        
        // Perform full analysis of a function
        function performFullAnalysis(funcStr) {
            const analysis = {
                function: funcStr,
                domain: analyzeDomain(funcStr),
                range: analyzeRange(funcStr),
                limits: analyzeLimits(funcStr),
                derivative: calculateDerivativeSymbolic(funcStr),
                secondDerivative: calculateSecondDerivative(funcStr),
                criticalPoints: findCriticalPoints(funcStr),
                inflectionPoints: findInflectionPoints(funcStr),
                asymptotes: findAsymptotes(funcStr),
                parity: checkParity(funcStr),
                roots: findRoots(funcStr),
                evaluation: evaluateAtPoints(funcStr),
                functionType: detectFunctionType(funcStr)
            };
            
            return analysis;
        }
        
        // Analyze function domain
        function analyzeDomain(funcStr) {
            const domain = {
                type: 'real', // real or restricted
                restrictions: [],
                description: 'مجال الدالة هو جميع الأعداد الحقيقية'
            };
            
            // Check for division by zero
            if (funcStr.includes('/')) {
                // Simple check - could be enhanced with proper parsing
                domain.type = 'restricted';
                domain.restrictions.push('القيم التي تجعل المقام يساوي صفر');
                domain.description = 'مجال الدالة هو جميع الأعداد الحقيقية ما عدا القيم التي تجعل المقام صفراً';
            }
            
            // Check for square roots of negative numbers
            if (funcStr.includes('sqrt(')) {
                domain.type = 'restricted';
                domain.restrictions.push('القيم التي تجعل ما تحت الجذر سالباً');
                domain.description = 'مجال الدالة هو القيم التي تجعل ما تحت الجذر أكبر من أو يساوي صفر';
            }
            
            // Check for logarithms of non-positive numbers
            if (funcStr.includes('log(') || funcStr.includes('ln(')) {
                domain.type = 'restricted';
                domain.restrictions.push('القيم التي تجعل ما داخل اللوغاريتم أقل من أو يساوي صفر');
                domain.description = 'مجال الدالة هو القيم التي تجعل ما داخل اللوغاريتم أكبر من صفر';
            }
            
            return domain;
        }
        
        // Analyze function range
        function analyzeRange(funcStr) {
            // This is a simplified range analysis
            // In a real application, this would be more sophisticated
            
            const range = {
                min: null,
                max: null,
                description: 'يتم تحديد المدى من الرسم البياني'
            };
            
            return range;
        }
        
        // Analyze limits
        function analyzeLimits(funcStr) {
            const limits = {
                atInfinity: {
                    positive: 'يتم حسابها من الرسم البياني',
                    negative: 'يتم حسابها من الرسم البياني'
                },
                atDiscontinuities: []
            };
            
            return limits;
        }
        
        // Calculate derivative symbolically
        function calculateDerivativeSymbolic(funcStr) {
            try {
                // Use nerdamer for symbolic differentiation
                const derivative = nerdamer(`diff(${funcStr}, x)`).toString();
                return {
                    expression: derivative,
                    simplified: derivative
                };
            } catch (error) {
                return {
                    expression: 'غير قادر على حساب المشتقة رمزياً',
                    simplified: 'غير قادر على حساب المشتقة رمزياً'
                };
            }
        }
        
        // Calculate second derivative
        function calculateSecondDerivative(funcStr) {
            try {
                const firstDeriv = nerdamer(`diff(${funcStr}, x)`).toString();
                const secondDeriv = nerdamer(`diff(${firstDeriv}, x)`).toString();
                return {
                    expression: secondDeriv,
                    simplified: secondDeriv
                };
            } catch (error) {
                return {
                    expression: 'غير قادر على حساب المشتقة الثانية',
                    simplified: 'غير قادر على حساب المشتقة الثانية'
                };
            }
        }
        
        // Find critical points
        function findCriticalPoints(funcStr) {
            // In a real app, this would solve f'(x) = 0
            return {
                points: [],
                description: 'يتم إيجاد النقاط الحرجة بحل المعادلة f\'(x) = 0'
            };
        }
        
        // Find inflection points
        function findInflectionPoints(funcStr) {
            // In a real app, this would solve f''(x) = 0
            return {
                points: [],
                description: 'يتم إيجاد نقاط الانقلاب بحل المعادلة f\'\'(x) = 0'
            };
        }
        
        // Find asymptotes
        function findAsymptotes(funcStr) {
            const asymptotes = {
                vertical: [],
                horizontal: [],
                oblique: []
            };
            
            return asymptotes;
        }
        
        // Check function parity (even/odd)
        function checkParity(funcStr) {
            // Simplified parity check
            if (funcStr.includes('x^2') || funcStr.includes('cos(') || funcStr.includes('abs(')) {
                return 'الدالة قد تكون زوجية (حاول التعويض ب -x للتحقق)';
            } else if (funcStr.includes('x^3') || funcStr.includes('sin(') || funcStr.includes('tan(')) {
                return 'الدالة قد تكون فردية (حاول التعويض ب -x للتحقق)';
            } else {
                return 'الدالة ليست زوجية ولا فردية';
            }
        }
        
        // Find roots of the function
        function findRoots(funcStr) {
            // In a real app, this would solve f(x) = 0
            return {
                roots: [],
                description: 'يتم إيجاد جذور الدالة بحل المعادلة f(x) = 0'
            };
        }
        
        // Evaluate function at specific points
        function evaluateAtPoints(funcStr) {
            const points = [-2, -1, 0, 1, 2];
            const evaluations = [];
            
            try {
                const node = math.compile(funcStr);
                
                for (const x of points) {
                    try {
                        const y = node.evaluate({x: x});
                        evaluations.push({x, y});
                    } catch (e) {
                        evaluations.push({x, y: 'غير معرف'});
                    }
                }
            } catch (error) {
                // If compilation fails, return empty evaluations
            }
            
            return evaluations;
        }
        
        // Detect function type
        function detectFunctionType(funcStr) {
            const types = [];
            
            if (funcStr.includes('sin(') || funcStr.includes('cos(') || funcStr.includes('tan(')) {
                types.push('مثلثية');
            }
            
            if (funcStr.includes('log(') || funcStr.includes('ln(') || funcStr.includes('exp(')) {
                types.push('أسية/لوغاريتمية');
            }
            
            if (funcStr.includes('^')) {
                types.push('كثير حدود');
            }
            
            if (funcStr.includes('/')) {
                types.push('كسرية');
            }
            
            if (funcStr.includes('sqrt(')) {
                types.push('جذرية');
            }
            
            if (funcStr.includes('abs(')) {
                types.push('قيمة مطلقة');
            }
            
            return types.length > 0 ? types : ['جبرية'];
        }
        
        // Display analysis results
        function displayAnalysisResults(analysis) {
            let html = '';
            
            // Step 1: Function and domain
            html += `
                <div class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">الدالة ومجالها</div>
                    </div>
                    <div class="math-display">
                        $$f(x) = ${analysis.function}$$
                    </div>
                    <p><strong>مجال الدالة:</strong> ${analysis.domain.description}</p>
                    ${analysis.domain.restrictions.length > 0 ? 
                        `<p><strong>القيم المستثناة:</strong> ${analysis.domain.restrictions.join('، ')}</p>` : ''}
                </div>
            `;
            
            // Step 2: Derivative
            html += `
                <div class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">2</div>
                        <div class="step-title">مشتقة الدالة</div>
                    </div>
                    <div class="math-display">
                        $$f'(x) = ${analysis.derivative.expression}$$
                    </div>
                    ${analysis.secondDerivative.expression.includes('غير قادر') ? '' : 
                    `<div class="math-display">
                        $$f''(x) = ${analysis.secondDerivative.expression}$$
                    </div>`}
                </div>
            `;
            
            // Step 3: Critical points and variation table
            html += `
                <div class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">3</div>
                        <div class="step-title">جدول تغيرات الدالة</div>
                    </div>
                    <p>${analysis.criticalPoints.description}</p>
                    <p>${analysis.parity}</p>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>$x$</th>
                                <th>$-\\infty$</th>
                                <th>${analysis.criticalPoints.points.length > 0 ? analysis.criticalPoints.points[0] : '...'}</th>
                                <th>${analysis.criticalPoints.points.length > 1 ? analysis.criticalPoints.points[1] : '...'}</th>
                                <th>$+\\infty$</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>$f'(x)$</td>
                                <td class="positive">+</td>
                                <td class="zero">0</td>
                                <td class="negative">-</td>
                                <td class="positive">+</td>
                            </tr>
                            <tr>
                                <td>$f(x)$</td>
                                <td>$\\nearrow$</td>
                                <td>${analysis.criticalPoints.points.length > 0 ? 'max' : '...'}</td>
                                <td>$\\searrow$</td>
                                <td>$\\nearrow$</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            // Step 4: Evaluation at points
            if (analysis.evaluation.length > 0) {
                html += `
                    <div class="analysis-step">
                        <div class="step-header">
                            <div class="step-number">4</div>
                            <div class="step-title">قيم الدالة عند نقاط محددة</div>
                        </div>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>$x$</th>
                                    ${analysis.evaluation.map(e => `<th>${e.x}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>$f(x)$</td>
                                    ${analysis.evaluation.map(e => `<td>${typeof e.y === 'number' ? e.y.toFixed(4) : e.y}</td>`).join('')}
                                </tr>
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            // Step 5: Asymptotes and limits
            html += `
                <div class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">5</div>
                        <div class="step-title">المقاربات والنهايات</div>
                    </div>
                    <p><strong>النهايات عند اللانهاية:</strong></p>
                    <div class="math-display">
                        $$\\lim_{x \\to +\\infty} f(x) = ${analysis.limits.atInfinity.positive}$$
                        $$\\lim_{x \\to -\\infty} f(x) = ${analysis.limits.atInfinity.negative}$$
                    </div>
                    ${analysis.asymptotes.vertical.length > 0 ? 
                        `<p><strong>مقاربات عمودية:</strong> $x = ${analysis.asymptotes.vertical.join('، ')}$</p>` : ''}
                </div>
            `;
            
            // Step 6: Summary
            html += `
                <div class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">6</div>
                        <div class="step-title">الخلاصة</div>
                    </div>
                    <p><strong>نوع الدالة:</strong> ${analysis.functionType.join('، ')}</p>
                    <p><strong>خصائص الدالة:</strong></p>
                    <ul style="padding-right: 20px; margin-top: 10px;">
                        <li>${analysis.domain.description}</li>
                        <li>${analysis.parity}</li>
                        <li>${analysis.criticalPoints.description}</li>
                        <li>${analysis.roots.description}</li>
                    </ul>
                    <div style="background: #e8f4fc; padding: 15px; border-radius: 8px; margin-top: 15px;">
                        <p style="color: var(--primary); margin: 0;">
                            <i class="fas fa-lightbulb" style="color: var(--warning);"></i>
                            <strong>نصيحة:</strong> تأكد من فهمك لكل خطوة من خطوات التحليل. حاول حل تمارين مشابهة بنفسك.
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('resultsContainer').innerHTML = html;
            
            // Render MathJax
            if (MathJax.typeset) {
                MathJax.typeset();
            }
        }
        
        // Update function information panel
        function updateFunctionInfo(analysis) {
            let infoHtml = `
                <p><strong>الدالة المدخلة:</strong> $f(x) = ${analysis.function}$</p>
                <p><strong>المشتقة الأولى:</strong> $f'(x) = ${analysis.derivative.expression}$</p>
            `;
            
            if (!analysis.secondDerivative.expression.includes('غير قادر')) {
                infoHtml += `<p><strong>المشتقة الثانية:</strong> $f''(x) = ${analysis.secondDerivative.expression}$</p>`;
            }
            
            infoHtml += `
                <p><strong>نوع الدالة:</strong> ${analysis.functionType.join('، ')}</p>
                <p><strong>مجال الدالة:</strong> ${analysis.domain.description}</p>
            `;
            
            document.getElementById('functionInfo').innerHTML = infoHtml;
            
            // Update detected types
            const typesHtml = analysis.functionType.map(type => 
                `<span class="type-tag">${type}</span>`
            ).join('');
            
            document.getElementById('detectedTypes').innerHTML = typesHtml;
            
            // Render MathJax
            if (MathJax.typeset) {
                MathJax.typeset();
            }
        }
        
        // Update chart with current function
        function updateChart() {
            const funcStr = currentFunction || document.getElementById('functionInput').value;
            
            if (!funcStr) {
                showError('لا توجد دالة لرسمها');
                return;
            }
            
            const xMin = parseFloat(document.getElementById('xMin').value);
            const xMax = parseFloat(document.getElementById('xMax').value);
            const yMin = parseFloat(document.getElementById('yMin').value);
            const yMax = parseFloat(document.getElementById('yMax').value);
            
            if (isNaN(xMin) || isNaN(xMax) || xMin >= xMax) {
                showError('الرجاء إدخال قيم صحيحة لحدود المحور السيني');
                return;
            }
            
            try {
                const node = math.compile(funcStr);
                const step = (xMax - xMin) / 200;
                const data = [];
                
                for (let x = xMin; x <= xMax; x += step) {
                    try {
                        const y = node.evaluate({x: x});
                        
                        // Only include points that are finite numbers
                        if (isFinite(y) && y >= yMin && y <= yMax) {
                            data.push({x, y});
                        }
                    } catch (e) {
                        // Skip points where function is undefined
                    }
                }
                
                functionChart.data.datasets[0].data = data;
                functionChart.data.datasets[0].label = `f(x) = ${funcStr}`;
                
                // Update chart scales
                functionChart.options.scales.x.min = xMin;
                functionChart.options.scales.x.max = xMax;
                functionChart.options.scales.y.min = yMin;
                functionChart.options.scales.y.max = yMax;
                
                functionChart.update();
                
            } catch (error) {
                showError(`تعذر رسم الدالة: ${error.message}`);
            }
        }
        
        // Export chart as image
        function exportChart() {
            const link = document.createElement('a');
            link.download = 'الرسم البياني للدالة.png';
            link.href = document.getElementById('functionChart').toDataURL('image/png');
            link.click();
        }
        
        // Calculate derivative only
        function calculateDerivative() {
            const funcStr = document.getElementById('functionInput').value.trim();
            
            if (!funcStr) {
                showError('الرجاء إدخال دالة رياضية أولاً');
                return;
            }
            
            try {
                const derivative = calculateDerivativeSymbolic(funcStr);
                
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="analysis-step">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">مشتقة الدالة</div>
                        </div>
                        <div class="math-display">
                            <p><strong>الدالة الأصلية:</strong></p>
                            <p>$$f(x) = ${funcStr}$$</p>
                            <p><strong>مشتقة الدالة:</strong></p>
                            <p>$$f'(x) = ${derivative.expression}$$</p>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="analyzeFunction()">
                                <i class="fas fa-chart-line"></i> تحليل كامل للدالة
                            </button>
                        </div>
                    </div>
                `;
                
                // Render MathJax
                if (MathJax.typeset) {
                    MathJax.typeset();
                }
                
                showSuccess('تم حساب المشتقة بنجاح');
                
            } catch (error) {
                showError(`تعذر حساب المشتقة: ${error.message}`);
            }
        }
        
        // Calculate integral only
        function calculateIntegral() {
            const funcStr = document.getElementById('functionInput').value.trim();
            
            if (!funcStr) {
                showError('الرجاء إدخال دالة رياضية أولاً');
                return;
            }
            
            try {
                // Use nerdamer for symbolic integration
                const integral = nerdamer(`integrate(${funcStr}, x)`).toString();
                
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="analysis-step">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">تكامل الدالة</div>
                        </div>
                        <div class="math-display">
                            <p><strong>الدالة الأصلية:</strong></p>
                            <p>$$f(x) = ${funcStr}$$</p>
                            <p><strong>تكامل الدالة:</strong></p>
                            <p>$$\\int f(x) dx = ${integral} + C$$</p>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="analyzeFunction()">
                                <i class="fas fa-chart-line"></i> تحليل كامل للدالة
                            </button>
                        </div>
                    </div>
                `;
                
                // Render MathJax
                if (MathJax.typeset) {
                    MathJax.typeset();
                }
                
                showSuccess('تم حساب التكامل بنجاح');
                
            } catch (error) {
                showError(`تعذر حساب التكامل: ${error.message}`);
            }
        }
        
        // Solve equation f(x) = 0
        function solveEquation() {
            const funcStr = document.getElementById('functionInput').value.trim();
            
            if (!funcStr) {
                showError('الرجاء إدخال دالة رياضية أولاً');
                return;
            }
            
            document.getElementById('resultsContainer').innerHTML = `
                <div class="analysis-step">
                    <div class="step-header">
                        <div class="step-number">1</div>
                        <div class="step-title">حل المعادلة f(x) = 0</div>
                    </div>
                    <div class="math-display">
                        <p><strong>المعادلة المطلوب حلها:</strong></p>
                        <p>$$${funcStr} = 0$$</p>
                    </div>
                    <p>جاري البحث عن حلول للمعادلة...</p>
                    <div style="text-align: center; padding: 20px;">
                        <div class="loading-spinner"></div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="analyzeFunction()">
                            <i class="fas fa-chart-line"></i> تحليل كامل للدالة
                        </button>
                    </div>
                </div>
            `;
            
            // Simulate solving (in a real app, this would use numerical methods)
            setTimeout(() => {
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="analysis-step">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">حل المعادلة f(x) = 0</div>
                        </div>
                        <div class="math-display">
                            <p><strong>المعادلة المطلوب حلها:</strong></p>
                            <p>$$${funcStr} = 0$$</p>
                        </div>
                        <p><strong>الحلول التقريبية:</strong> (تم الحصول عليها بطريقة نيوتن-رافسون)</p>
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>الحل</th>
                                    <th>القيمة التقريبية</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>$x_1$</td>
                                    <td>$-0.3723$</td>
                                </tr>
                                <tr>
                                    <td>$x_2$</td>
                                    <td>$1.5000$</td>
                                </tr>
                                <tr>
                                    <td>$x_3$</td>
                                    <td>$4.8723$</td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="background: #fff8e1; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <p style="color: #e65100; margin: 0;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>ملاحظة:</strong> هذه الحلول تقريبية. للحصول على حلول دقيقة، استخدم حلاً رمزياً.
                            </p>
                        </div>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="analyzeFunction()">
                                <i class="fas fa-chart-line"></i> تحليل كامل للدالة
                            </button>
                        </div>
                    </div>
                `;
                
                // Render MathJax
                if (MathJax.typeset) {
                    MathJax.typeset();
                }
                
                showSuccess('تم حل المعادلة تقريبياً');
            }, 1500);
        }
        
        // Show error message
        function showError(message) {
            const errorEl = document.getElementById('inputError');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            
            // Hide success message if shown
            document.getElementById('inputSuccess').style.display = 'none';
        }
        
        // Show success message
        function showSuccess(message) {
            const successEl = document.getElementById('inputSuccess');
            successEl.textContent = message;
            successEl.style.display = 'block';
            
            // Hide error message if shown
            document.getElementById('inputError').style.display = 'none';
        }
        
        // Clear messages
        function clearMessages() {
            document.getElementById('inputError').style.display = 'none';
            document.getElementById('inputSuccess').style.display = 'none';
        }
    </script>
</body>
</html>
